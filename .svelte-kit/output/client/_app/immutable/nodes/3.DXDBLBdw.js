import{f as B,a as P}from"../chunks/Ca6PdoZt.js";import{i as zt}from"../chunks/DVTYvNbR.js";import{c as Ce,o as _e}from"../chunks/BuV3rt98.js";import{h as it,Q as Vt,X as W,T as Jt,U as D,Y as A,W as L,g as i,m as G,s as b,e as me,aM as k,aN as be,V as Ie}from"../chunks/BtxYcPeY.js";import{s as At}from"../chunks/CHjT2g_j.js";import{i as V}from"../chunks/CVtanQ5f.js";import{h as we}from"../chunks/-zzTvoIy.js";import{e as R}from"../chunks/DH3FBsMJ.js";import{b as Oe}from"../chunks/CFRiFLgw.js";const Nt=[...` 	
\r\f¬†\v\uFEFF`];function Re(t,s,n){var e=""+t;if(n){for(var o in n)if(n[o])e=e?e+" "+o:o;else if(e.length)for(var a=o.length,l=0;(l=e.indexOf(o,l))>=0;){var f=l+a;(l===0||Nt.includes(e[l-1]))&&(f===e.length||Nt.includes(e[f]))?e=(l===0?"":e.substring(0,l))+e.substring(f+1):l=f}}return e===""?null:e}function Se(t,s){return t==null?null:String(t)}function st(t,s,n,e,o,a){var l=t.__className;if(it||l!==n||l===void 0){var f=Re(n,e,a);(!it||f!==t.getAttribute("class"))&&(f==null?t.removeAttribute("class"):t.className=f),t.__className=n}else if(a&&o!==a)for(var y in a){var I=!!a[y];(o==null||I!==!!o[y])&&t.classList.toggle(y,I)}return a}function ht(t,s,n,e){var o=t.__style;if(it||o!==s){var a=Se(s);(!it||a!==t.getAttribute("style"))&&(a==null?t.removeAttribute("style"):t.style.cssText=a),t.__style=s}return e}var Te=B('<div class="toolbar svelte-1ld6r3r"><button>‚úèÔ∏è Pen</button> <button>üßπ Eraser</button> <button>üî≤ Select</button> <button>ü§ö Pan</button> <div class="divider svelte-1ld6r3r"></div> <button class="btn secondary svelte-1ld6r3r">üóëÔ∏è Clear</button></div>');function Ae(t,s){Vt(s,!1);const n=Ce();let e=G("pen");function o(M){b(e,M),n("mode",{mode:i(e)})}function a(){n("clear")}zt();var l=Te(),f=D(l);let y;var I=A(f,2);let O;var S=A(I,2);let C;var _=A(S,2);let m;var T=A(_,4);L(l),W(()=>{y=st(f,1,"btn svelte-1ld6r3r",null,y,{active:i(e)==="pen"}),O=st(I,1,"btn svelte-1ld6r3r",null,O,{active:i(e)==="eraser"}),C=st(S,1,"btn svelte-1ld6r3r",null,C,{active:i(e)==="select"}),m=st(_,1,"btn svelte-1ld6r3r",null,m,{active:i(e)==="pan"})}),R("click",f,()=>o("pen")),R("click",I,()=>o("eraser")),R("click",S,()=>o("select")),R("click",_,()=>o("pan")),R("click",T,a),P(t,l),Jt()}var xt;(function(t){t.STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object"})(xt||(xt={}));var Mt;(function(t){t.LANGUAGE_UNSPECIFIED="language_unspecified",t.PYTHON="python"})(Mt||(Mt={}));var Dt;(function(t){t.OUTCOME_UNSPECIFIED="outcome_unspecified",t.OUTCOME_OK="outcome_ok",t.OUTCOME_FAILED="outcome_failed",t.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(Dt||(Dt={}));const Lt=["user","model","function","system"];var Gt;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(Gt||(Gt={}));var Ut;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(Ut||(Ut={}));var Yt;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(Yt||(Yt={}));var $t;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER"})($t||($t={}));var J;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.OTHER="OTHER"})(J||(J={}));var kt;(function(t){t.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",t.RETRIEVAL_QUERY="RETRIEVAL_QUERY",t.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",t.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",t.CLASSIFICATION="CLASSIFICATION",t.CLUSTERING="CLUSTERING"})(kt||(kt={}));var Ht;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE"})(Ht||(Ht={}));var Ft;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Ft||(Ft={}));class x extends Error{constructor(s){super(`[GoogleGenerativeAI Error]: ${s}`)}}class q extends x{constructor(s,n){super(s),this.response=n}}class Qt extends x{constructor(s,n,e,o){super(s),this.status=n,this.statusText=e,this.errorDetails=o}}class F extends x{}class Zt extends x{}const Ne="https://generativelanguage.googleapis.com",xe="v1beta",Me="0.24.1",De="genai-js";var j;(function(t){t.GENERATE_CONTENT="generateContent",t.STREAM_GENERATE_CONTENT="streamGenerateContent",t.COUNT_TOKENS="countTokens",t.EMBED_CONTENT="embedContent",t.BATCH_EMBED_CONTENTS="batchEmbedContents"})(j||(j={}));class Le{constructor(s,n,e,o,a){this.model=s,this.task=n,this.apiKey=e,this.stream=o,this.requestOptions=a}toString(){var s,n;const e=((s=this.requestOptions)===null||s===void 0?void 0:s.apiVersion)||xe;let a=`${((n=this.requestOptions)===null||n===void 0?void 0:n.baseUrl)||Ne}/${e}/${this.model}:${this.task}`;return this.stream&&(a+="?alt=sse"),a}}function Ge(t){const s=[];return t?.apiClient&&s.push(t.apiClient),s.push(`${De}/${Me}`),s.join(" ")}async function Ue(t){var s;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",Ge(t.requestOptions)),n.append("x-goog-api-key",t.apiKey);let e=(s=t.requestOptions)===null||s===void 0?void 0:s.customHeaders;if(e){if(!(e instanceof Headers))try{e=new Headers(e)}catch(o){throw new F(`unable to convert customHeaders value ${JSON.stringify(e)} to Headers: ${o.message}`)}for(const[o,a]of e.entries()){if(o==="x-goog-api-key")throw new F(`Cannot set reserved header name ${o}`);if(o==="x-goog-api-client")throw new F(`Header name ${o} can only be set using the apiClient field`);n.append(o,a)}}return n}async function Ye(t,s,n,e,o,a){const l=new Le(t,s,n,e,a);return{url:l.toString(),fetchOptions:Object.assign(Object.assign({},Fe(a)),{method:"POST",headers:await Ue(l),body:o})}}async function tt(t,s,n,e,o,a={},l=fetch){const{url:f,fetchOptions:y}=await Ye(t,s,n,e,o,a);return $e(f,y,l)}async function $e(t,s,n=fetch){let e;try{e=await n(t,s)}catch(o){ke(o,t)}return e.ok||await He(e,t),e}function ke(t,s){let n=t;throw n.name==="AbortError"?(n=new Zt(`Request aborted when fetching ${s.toString()}: ${t.message}`),n.stack=t.stack):t instanceof Qt||t instanceof F||(n=new x(`Error fetching from ${s.toString()}: ${t.message}`),n.stack=t.stack),n}async function He(t,s){let n="",e;try{const o=await t.json();n=o.error.message,o.error.details&&(n+=` ${JSON.stringify(o.error.details)}`,e=o.error.details)}catch{}throw new Qt(`Error fetching from ${s.toString()}: [${t.status} ${t.statusText}] ${n}`,t.status,t.statusText,e)}function Fe(t){const s={};if(t?.signal!==void 0||t?.timeout>=0){const n=new AbortController;t?.timeout>=0&&setTimeout(()=>n.abort(),t.timeout),t?.signal&&t.signal.addEventListener("abort",()=>{n.abort()}),s.signal=n.signal}return s}function vt(t){return t.text=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),ot(t.candidates[0]))throw new q(`${H(t)}`,t);return Pe(t)}else if(t.promptFeedback)throw new q(`Text not available. ${H(t)}`,t);return""},t.functionCall=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ot(t.candidates[0]))throw new q(`${H(t)}`,t);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Pt(t)[0]}else if(t.promptFeedback)throw new q(`Function call not available. ${H(t)}`,t)},t.functionCalls=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ot(t.candidates[0]))throw new q(`${H(t)}`,t);return Pt(t)}else if(t.promptFeedback)throw new q(`Function call not available. ${H(t)}`,t)},t}function Pe(t){var s,n,e,o;const a=[];if(!((n=(s=t.candidates)===null||s===void 0?void 0:s[0].content)===null||n===void 0)&&n.parts)for(const l of(o=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||o===void 0?void 0:o.parts)l.text&&a.push(l.text),l.executableCode&&a.push("\n```"+l.executableCode.language+`
`+l.executableCode.code+"\n```\n"),l.codeExecutionResult&&a.push("\n```\n"+l.codeExecutionResult.output+"\n```\n");return a.length>0?a.join(""):""}function Pt(t){var s,n,e,o;const a=[];if(!((n=(s=t.candidates)===null||s===void 0?void 0:s[0].content)===null||n===void 0)&&n.parts)for(const l of(o=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||o===void 0?void 0:o.parts)l.functionCall&&a.push(l.functionCall);if(a.length>0)return a}const je=[J.RECITATION,J.SAFETY,J.LANGUAGE];function ot(t){return!!t.finishReason&&je.includes(t.finishReason)}function H(t){var s,n,e;let o="";if((!t.candidates||t.candidates.length===0)&&t.promptFeedback)o+="Response was blocked",!((s=t.promptFeedback)===null||s===void 0)&&s.blockReason&&(o+=` due to ${t.promptFeedback.blockReason}`),!((n=t.promptFeedback)===null||n===void 0)&&n.blockReasonMessage&&(o+=`: ${t.promptFeedback.blockReasonMessage}`);else if(!((e=t.candidates)===null||e===void 0)&&e[0]){const a=t.candidates[0];ot(a)&&(o+=`Candidate was blocked due to ${a.finishReason}`,a.finishMessage&&(o+=`: ${a.finishMessage}`))}return o}function Q(t){return this instanceof Q?(this.v=t,this):new Q(t)}function Be(t,s,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n.apply(t,s||[]),o,a=[];return o={},l("next"),l("throw"),l("return"),o[Symbol.asyncIterator]=function(){return this},o;function l(C){e[C]&&(o[C]=function(_){return new Promise(function(m,T){a.push([C,_,m,T])>1||f(C,_)})})}function f(C,_){try{y(e[C](_))}catch(m){S(a[0][3],m)}}function y(C){C.value instanceof Q?Promise.resolve(C.value.v).then(I,O):S(a[0][2],C)}function I(C){f("next",C)}function O(C){f("throw",C)}function S(C,_){C(_),a.shift(),a.length&&f(a[0][0],a[0][1])}}const jt=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function Ke(t){const s=t.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),n=Xe(s),[e,o]=n.tee();return{stream:We(e),response:qe(o)}}async function qe(t){const s=[],n=t.getReader();for(;;){const{done:e,value:o}=await n.read();if(e)return vt(ze(s));s.push(o)}}function We(t){return Be(this,arguments,function*(){const n=t.getReader();for(;;){const{value:e,done:o}=yield Q(n.read());if(o)break;yield yield Q(vt(e))}})}function Xe(t){const s=t.getReader();return new ReadableStream({start(e){let o="";return a();function a(){return s.read().then(({value:l,done:f})=>{if(f){if(o.trim()){e.error(new x("Failed to parse stream"));return}e.close();return}o+=l;let y=o.match(jt),I;for(;y;){try{I=JSON.parse(y[1])}catch{e.error(new x(`Error parsing JSON response: "${y[1]}"`));return}e.enqueue(I),o=o.substring(y[0].length),y=o.match(jt)}return a()}).catch(l=>{let f=l;throw f.stack=l.stack,f.name==="AbortError"?f=new Zt("Request aborted when reading from the stream"):f=new x("Error reading from the stream"),f})}}})}function ze(t){const s=t[t.length-1],n={promptFeedback:s?.promptFeedback};for(const e of t){if(e.candidates){let o=0;for(const a of e.candidates)if(n.candidates||(n.candidates=[]),n.candidates[o]||(n.candidates[o]={index:o}),n.candidates[o].citationMetadata=a.citationMetadata,n.candidates[o].groundingMetadata=a.groundingMetadata,n.candidates[o].finishReason=a.finishReason,n.candidates[o].finishMessage=a.finishMessage,n.candidates[o].safetyRatings=a.safetyRatings,a.content&&a.content.parts){n.candidates[o].content||(n.candidates[o].content={role:a.content.role||"user",parts:[]});const l={};for(const f of a.content.parts)f.text&&(l.text=f.text),f.functionCall&&(l.functionCall=f.functionCall),f.executableCode&&(l.executableCode=f.executableCode),f.codeExecutionResult&&(l.codeExecutionResult=f.codeExecutionResult),Object.keys(l).length===0&&(l.text=""),n.candidates[o].content.parts.push(l)}o++}e.usageMetadata&&(n.usageMetadata=e.usageMetadata)}return n}async function te(t,s,n,e){const o=await tt(s,j.STREAM_GENERATE_CONTENT,t,!0,JSON.stringify(n),e);return Ke(o)}async function ee(t,s,n,e){const a=await(await tt(s,j.GENERATE_CONTENT,t,!1,JSON.stringify(n),e)).json();return{response:vt(a)}}function ne(t){if(t!=null){if(typeof t=="string")return{role:"system",parts:[{text:t}]};if(t.text)return{role:"system",parts:[t]};if(t.parts)return t.role?t:{role:"system",parts:t.parts}}}function Z(t){let s=[];if(typeof t=="string")s=[{text:t}];else for(const n of t)typeof n=="string"?s.push({text:n}):s.push(n);return Ve(s)}function Ve(t){const s={role:"user",parts:[]},n={role:"function",parts:[]};let e=!1,o=!1;for(const a of t)"functionResponse"in a?(n.parts.push(a),o=!0):(s.parts.push(a),e=!0);if(e&&o)throw new x("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!e&&!o)throw new x("No content is provided for sending chat message.");return e?s:n}function Je(t,s){var n;let e={model:s?.model,generationConfig:s?.generationConfig,safetySettings:s?.safetySettings,tools:s?.tools,toolConfig:s?.toolConfig,systemInstruction:s?.systemInstruction,cachedContent:(n=s?.cachedContent)===null||n===void 0?void 0:n.name,contents:[]};const o=t.generateContentRequest!=null;if(t.contents){if(o)throw new F("CountTokensRequest must have one of contents or generateContentRequest, not both.");e.contents=t.contents}else if(o)e=Object.assign(Object.assign({},e),t.generateContentRequest);else{const a=Z(t);e.contents=[a]}return{generateContentRequest:e}}function Bt(t){let s;return t.contents?s=t:s={contents:[Z(t)]},t.systemInstruction&&(s.systemInstruction=ne(t.systemInstruction)),s}function Qe(t){return typeof t=="string"||Array.isArray(t)?{content:Z(t)}:t}const Kt=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],Ze={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function tn(t){let s=!1;for(const n of t){const{role:e,parts:o}=n;if(!s&&e!=="user")throw new x(`First content should be with role 'user', got ${e}`);if(!Lt.includes(e))throw new x(`Each item should include role field. Got ${e} but valid roles are: ${JSON.stringify(Lt)}`);if(!Array.isArray(o))throw new x("Content should have 'parts' property with an array of Parts");if(o.length===0)throw new x("Each Content should have at least one part");const a={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const f of o)for(const y of Kt)y in f&&(a[y]+=1);const l=Ze[e];for(const f of Kt)if(!l.includes(f)&&a[f]>0)throw new x(`Content with role '${e}' can't contain '${f}' part`);s=!0}}function qt(t){var s;if(t.candidates===void 0||t.candidates.length===0)return!1;const n=(s=t.candidates[0])===null||s===void 0?void 0:s.content;if(n===void 0||n.parts===void 0||n.parts.length===0)return!1;for(const e of n.parts)if(e===void 0||Object.keys(e).length===0||e.text!==void 0&&e.text==="")return!1;return!0}const Wt="SILENT_ERROR";class en{constructor(s,n,e,o={}){this.model=n,this.params=e,this._requestOptions=o,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=s,e?.history&&(tn(e.history),this._history=e.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(s,n={}){var e,o,a,l,f,y;await this._sendPromise;const I=Z(s),O={safetySettings:(e=this.params)===null||e===void 0?void 0:e.safetySettings,generationConfig:(o=this.params)===null||o===void 0?void 0:o.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(l=this.params)===null||l===void 0?void 0:l.toolConfig,systemInstruction:(f=this.params)===null||f===void 0?void 0:f.systemInstruction,cachedContent:(y=this.params)===null||y===void 0?void 0:y.cachedContent,contents:[...this._history,I]},S=Object.assign(Object.assign({},this._requestOptions),n);let C;return this._sendPromise=this._sendPromise.then(()=>ee(this._apiKey,this.model,O,S)).then(_=>{var m;if(qt(_.response)){this._history.push(I);const T=Object.assign({parts:[],role:"model"},(m=_.response.candidates)===null||m===void 0?void 0:m[0].content);this._history.push(T)}else{const T=H(_.response);T&&console.warn(`sendMessage() was unsuccessful. ${T}. Inspect response object for details.`)}C=_}).catch(_=>{throw this._sendPromise=Promise.resolve(),_}),await this._sendPromise,C}async sendMessageStream(s,n={}){var e,o,a,l,f,y;await this._sendPromise;const I=Z(s),O={safetySettings:(e=this.params)===null||e===void 0?void 0:e.safetySettings,generationConfig:(o=this.params)===null||o===void 0?void 0:o.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(l=this.params)===null||l===void 0?void 0:l.toolConfig,systemInstruction:(f=this.params)===null||f===void 0?void 0:f.systemInstruction,cachedContent:(y=this.params)===null||y===void 0?void 0:y.cachedContent,contents:[...this._history,I]},S=Object.assign(Object.assign({},this._requestOptions),n),C=te(this._apiKey,this.model,O,S);return this._sendPromise=this._sendPromise.then(()=>C).catch(_=>{throw new Error(Wt)}).then(_=>_.response).then(_=>{if(qt(_)){this._history.push(I);const m=Object.assign({},_.candidates[0].content);m.role||(m.role="model"),this._history.push(m)}else{const m=H(_);m&&console.warn(`sendMessageStream() was unsuccessful. ${m}. Inspect response object for details.`)}}).catch(_=>{_.message!==Wt&&console.error(_)}),C}}async function nn(t,s,n,e){return(await tt(s,j.COUNT_TOKENS,t,!1,JSON.stringify(n),e)).json()}async function sn(t,s,n,e){return(await tt(s,j.EMBED_CONTENT,t,!1,JSON.stringify(n),e)).json()}async function on(t,s,n,e){const o=n.requests.map(l=>Object.assign(Object.assign({},l),{model:s}));return(await tt(s,j.BATCH_EMBED_CONTENTS,t,!1,JSON.stringify({requests:o}),e)).json()}class Xt{constructor(s,n,e={}){this.apiKey=s,this._requestOptions=e,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=ne(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(s,n={}){var e;const o=Bt(s),a=Object.assign(Object.assign({},this._requestOptions),n);return ee(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(e=this.cachedContent)===null||e===void 0?void 0:e.name},o),a)}async generateContentStream(s,n={}){var e;const o=Bt(s),a=Object.assign(Object.assign({},this._requestOptions),n);return te(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(e=this.cachedContent)===null||e===void 0?void 0:e.name},o),a)}startChat(s){var n;return new en(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},s),this._requestOptions)}async countTokens(s,n={}){const e=Je(s,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),o=Object.assign(Object.assign({},this._requestOptions),n);return nn(this.apiKey,this.model,e,o)}async embedContent(s,n={}){const e=Qe(s),o=Object.assign(Object.assign({},this._requestOptions),n);return sn(this.apiKey,this.model,e,o)}async batchEmbedContents(s,n={}){const e=Object.assign(Object.assign({},this._requestOptions),n);return on(this.apiKey,this.model,s,e)}}class an{constructor(s){this.apiKey=s}getGenerativeModel(s,n){if(!s.model)throw new x("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Xt(this.apiKey,s,n)}getGenerativeModelFromCachedContent(s,n,e){if(!s.name)throw new F("Cached content must contain a `name` field.");if(!s.model)throw new F("Cached content must contain a `model` field.");const o=["model","systemInstruction"];for(const l of o)if(n?.[l]&&s[l]&&n?.[l]!==s[l]){if(l==="model"){const f=n.model.startsWith("models/")?n.model.replace("models/",""):n.model,y=s.model.startsWith("models/")?s.model.replace("models/",""):s.model;if(f===y)continue}throw new F(`Different value for "${l}" specified in modelParams (${n[l]}) and cachedContent (${s[l]})`)}const a=Object.assign(Object.assign({},n),{model:s.model,tools:s.tools,toolConfig:s.toolConfig,systemInstruction:s.systemInstruction,cachedContent:s});return new Xt(this.apiKey,a,e)}}const rn="AIzaSyClCRB7DMyqCTY6ij7H_V5sBg4wUj6N_QI",ln=new an(rn);async function cn(t,s){const n=ln.getGenerativeModel({model:"gemini-2.5-flash"});let e="";s==="mindmap"?e="Analyze this handwritten note and create a mind map structure. Extract the main topic and all subtopics, relationships, and key concepts. Format as a hierarchical mind map with clear indentation levels (use spaces at the start of lines to show hierarchy).":s==="analyze"?e="Analyze and summarize this handwritten note. Identify the main topic, key points, and important details. Provide a clear, organized summary.":s==="tidy"&&(e="Read this handwritten note and transcribe it in a clean, organized format. Fix any spelling errors and improve readability while preserving all information.");try{const o=t.replace(/^data:image\/\w+;base64,/,"");return(await(await n.generateContent([e,{inlineData:{data:o,mimeType:"image/png"}}])).response).text()}catch(o){throw console.error("Gemini API error:",o),o}}var dn=B('<div class="selection-box svelte-a8vy9b"></div>'),un=B('<div class="popup svelte-a8vy9b"><button class="popup-btn mindmap svelte-a8vy9b">üß† Create Mind Map</button> <button class="popup-btn analyze svelte-a8vy9b">‚ú® Analyze & Summarize</button> <button class="popup-btn tidy svelte-a8vy9b">üìù Tidy Up Notes</button> <button class="cancel-btn svelte-a8vy9b">Cancel</button></div>'),fn=B('<div class="processing svelte-a8vy9b"><div class="spinner svelte-a8vy9b">‚ú®</div> <p>AI is analyzing your notes...</p></div>'),hn=B('<div class="mindmap-controls svelte-a8vy9b"><div class="control-group svelte-a8vy9b"><p class="svelte-a8vy9b">üéØ Use <strong>Pan mode</strong> to move ‚Ä¢ <strong>Scroll</strong> to zoom ‚Ä¢ <strong>Click nodes</strong> to drag</p> <span class="zoom-level svelte-a8vy9b"> </span></div> <div class="button-group svelte-a8vy9b"><button class="control-btn svelte-a8vy9b">üîÑ Reset View</button> <button class="control-btn close svelte-a8vy9b">‚úï Close</button></div></div>'),vn=B('<div class="result-panel svelte-a8vy9b"><div class="result-header svelte-a8vy9b"><h3 class="svelte-a8vy9b">‚ú® AI Result</h3> <button class="svelte-a8vy9b">√ó</button></div> <div class="result-content svelte-a8vy9b"><pre class="svelte-a8vy9b"> </pre></div></div>'),gn=B('<div class="app-container svelte-a8vy9b"><!> <canvas class="drawing-canvas svelte-a8vy9b"></canvas> <!> <!> <!> <!> <!> <div class="instructions svelte-a8vy9b"><h4 class="svelte-a8vy9b">How to use:</h4> <ul class="svelte-a8vy9b"><li class="svelte-a8vy9b">‚úèÔ∏è Use <strong>Pen</strong> to draw notes</li> <li class="svelte-a8vy9b">üßπ Use <strong>Eraser</strong> to erase</li> <li class="svelte-a8vy9b">üî≤ Use <strong>Select</strong> to lasso an area</li> <li class="svelte-a8vy9b">ü§ö Use <strong>Pan</strong> to move mind map</li> <li class="svelte-a8vy9b">‚ú® Choose an AI action to analyze</li></ul></div></div>');function On(t,s){Vt(s,!1);let n=G(),e,o=!1,a=0,l=0,f=G(!1),y=G(!1),I=G(null),O=G(!1),S=[],C=G(null),_={x:0,y:0},m=0,T=0,M=G(1),et=G(!1),gt=0,pt=0,N=G("pen"),p=G({active:!1,startX:0,startY:0,x:0,y:0,w:0,h:0});_e(()=>(k(n,i(n).width=window.innerWidth),k(n,i(n).height=window.innerHeight),e=i(n).getContext("2d"),e.lineWidth=3,e.lineCap="round",e.lineJoin="round",e.strokeStyle="#1e293b",nt(),i(n).addEventListener("wheel",Et,{passive:!1}),()=>{i(n).removeEventListener("wheel",Et)}));function Et(r){if(!i(O))return;r.preventDefault();const c=i(n).getBoundingClientRect(),h=r.clientX-c.left,v=r.clientY-c.top,u=.1,d=r.deltaY>0?-u:u,g=Math.min(Math.max(.5,i(M)+d),3),w=g/i(M);m=h-(h-m)*w,T=v-(v-T)*w,b(M,g),X()}function nt(){e.strokeStyle="#f1f5f9",e.lineWidth=1;for(let c=0;c<i(n).width;c+=30)e.beginPath(),e.moveTo(c,0),e.lineTo(c,i(n).height),e.stroke();for(let c=0;c<i(n).height;c+=30)e.beginPath(),e.moveTo(0,c),e.lineTo(i(n).width,c),e.stroke();e.strokeStyle="#1e293b",e.lineWidth=3}function yt(r){const c=i(n).getBoundingClientRect();let h,v;return"touches"in r&&r.touches[0]?(h=r.touches[0].clientX,v=r.touches[0].clientY):(h=r.clientX,v=r.clientY),{x:h-c.left,y:v-c.top}}function Ct(r,c){return{x:(r-m)/i(M),y:(c-T)/i(M)}}function _t(r){r.preventDefault();const{x:c,y:h}=yt(r);if(i(O)){const v=Ct(c,h),u=S.find(d=>v.x>=d.x-d.width/2&&v.x<=d.x+d.width/2&&v.y>=d.y-d.height/2&&v.y<=d.y+d.height/2);if(u){b(C,u),_.x=v.x-u.x,_.y=v.y-u.y;return}if(i(N)==="pan"){b(et,!0),gt=c-m,pt=h-T;return}}i(N)==="pen"||i(N)==="eraser"?(o=!0,a=c,l=h,i(N)==="eraser"?(e.globalCompositeOperation="destination-out",e.lineWidth=20):(e.globalCompositeOperation="source-over",e.lineWidth=3)):i(N)==="select"&&b(p,{active:!0,startX:c,startY:h,x:c,y:h,w:0,h:0})}function mt(r){r.preventDefault();const{x:c,y:h}=yt(r);if(i(et)&&i(O)){m=c-gt,T=h-pt,X();return}if(i(C)&&i(O)){const v=Ct(c,h);k(C,i(C).x=v.x-_.x),k(C,i(C).y=v.y-_.y),X();return}(i(N)==="pen"||i(N)==="eraser")&&o&&(e.beginPath(),e.moveTo(a,l),e.lineTo(c,h),e.stroke(),a=c,l=h),i(N)==="select"&&i(p).active&&(k(p,i(p).x=Math.min(c,i(p).startX)),k(p,i(p).y=Math.min(h,i(p).startY)),k(p,i(p).w=Math.abs(c-i(p).startX)),k(p,i(p).h=Math.abs(h-i(p).startY)))}function at(r){r.preventDefault(),o=!1,b(C,null),b(et,!1),i(N)==="eraser"&&(e.globalCompositeOperation="source-over",e.lineWidth=3),i(N)==="select"&&i(p).active&&i(p).w>10&&i(p).h>10&&(k(p,i(p).active=!1),b(f,!0))}function se(r){b(N,r.detail.mode),b(f,!1)}function rt(){e.clearRect(0,0,i(n).width,i(n).height),nt(),b(I,null),b(f,!1),b(O,!1),S=[],m=0,T=0,b(M,1)}function oe(){const r=document.createElement("canvas");return r.width=i(p).w,r.height=i(p).h,r.getContext("2d").drawImage(i(n),i(p).x,i(p).y,i(p).w,i(p).h,0,0,i(p).w,i(p).h),r.toDataURL("image/png")}function ie(r){const c=r.split(`
`).filter(u=>u.trim()),h=[];let v=0;c.forEach(u=>{const d=u.trim();if(d&&!d.startsWith("#")){const g=u.search(/\S/),w=Math.floor(g/2),E=d.replace(/^[-‚Ä¢‚Üí*:]/g,"").trim();E&&h.push({id:v++,text:E,level:w,parent:null,x:0,y:0,width:0,height:0})}});for(let u=0;u<h.length;u++)if(h[u].level>0){for(let d=u-1;d>=0;d--)if(h[d].level<h[u].level){h[u].parent=h[d].id;break}}return h}function ae(r){if(r.length===0)return;const c=i(n).width/2;i(n).height/2;const h=200,v=300,u=r.filter(E=>E.level===0);u.length>0&&(u[0].x=c,u[0].y=100);const d={};r.forEach(E=>{E.parent!==null&&(d[E.parent]||(d[E.parent]=[]),d[E.parent].push(E))});function g(E){const Y=d[E]||[];if(Y.length===0)return 1;let K=0;return Y.forEach(z=>{K+=g(z.id)}),Math.max(Y.length,K)}function w(E,Y,K){const z=d[E]||[];if(z.length===0)return;const St=r.find($=>$.id===E);if(!St)return;const Tt=z.map($=>g($.id)),Ee=Tt.reduce(($,ut)=>$+ut,0);let dt=Y;z.forEach(($,ut)=>{const ye=Tt[ut],ft=K*ye/Ee;$.x=dt+ft/2,$.y=St.y+h,w($.id,dt,ft),dt+=ft})}if(u.length>0){const E=u[0].id,Y=g(E)*v,K=c-Y/2;w(E,K,Y)}m=0,T=0,b(M,1)}function X(){e.clearRect(0,0,i(n).width,i(n).height),nt(),e.save(),e.translate(m,T),e.scale(i(M),i(M)),S.forEach(r=>{if(r.parent!==null){const c=S.find(h=>h.id===r.parent);c&&re(c,r)}}),S.forEach(r=>{le(r)}),e.restore()}function re(r,c){e.save();const h=r.x,v=r.y+r.height/2,u=c.x,d=c.y-c.height/2,g=(v+d)/2,w=e.createLinearGradient(h,v,u,d);w.addColorStop(0,"#3b82f6"),w.addColorStop(1,"#8b5cf6"),e.strokeStyle=w,e.lineWidth=3,e.lineCap="round",e.beginPath(),e.moveTo(h,v),e.bezierCurveTo(h,g,u,g,u,d),e.stroke();const E=12;e.fillStyle="#8b5cf6",e.beginPath(),e.moveTo(u,d),e.lineTo(u-E/2,d-E),e.lineTo(u+E/2,d-E),e.closePath(),e.fill(),e.restore()}function le(r){e.save(),e.font=r.level===0?"bold 20px Inter, sans-serif":"16px Inter, sans-serif";const c=e.measureText(r.text),v=Math.max(c.width+24*2,150),u=60;r.width=v,r.height=u;const d=r.x-v/2,g=r.y-u/2;e.shadowColor="rgba(0, 0, 0, 0.2)",e.shadowBlur=20,e.shadowOffsetX=0,e.shadowOffsetY=5;let w;r.level===0?(w=e.createLinearGradient(d,g,d,g+u),w.addColorStop(0,"#3b82f6"),w.addColorStop(1,"#2563eb")):r.level===1?(w=e.createLinearGradient(d,g,d,g+u),w.addColorStop(0,"#8b5cf6"),w.addColorStop(1,"#7c3aed")):(w=e.createLinearGradient(d,g,d,g+u),w.addColorStop(0,"#06b6d4"),w.addColorStop(1,"#0891b2")),e.fillStyle=w;const E=15;e.beginPath(),e.moveTo(d+E,g),e.lineTo(d+v-E,g),e.quadraticCurveTo(d+v,g,d+v,g+E),e.lineTo(d+v,g+u-E),e.quadraticCurveTo(d+v,g+u,d+v-E,g+u),e.lineTo(d+E,g+u),e.quadraticCurveTo(d,g+u,d,g+u-E),e.lineTo(d,g+E),e.quadraticCurveTo(d,g,d+E,g),e.closePath(),e.fill(),e.shadowColor="transparent",e.strokeStyle="rgba(255, 255, 255, 0.4)",e.lineWidth=2,e.stroke(),e.fillStyle="#ffffff",e.textAlign="center",e.textBaseline="middle",e.fillText(r.text,r.x,r.y),e.font="24px serif";const Y=r.level===0?"üéØ":r.level===1?"üìå":"üí°";e.fillText(Y,d+20,r.y),e.restore()}async function lt(r){b(y,!0),b(f,!1);try{const c=oe(),h=await cn(c,r);r==="tidy"?(rt(),ce(h)):r==="mindmap"?(S=ie(h),ae(S),b(O,!0),b(N,"pan"),X()):b(I,{type:r,content:h})}catch(c){console.error("Error:",c),b(I,{type:"error",content:"Sorry, there was an error processing your request. Please try again."})}finally{b(y,!1)}}function ce(r){e.clearRect(0,0,i(n).width,i(n).height),nt(),e.font='18px "Inter", -apple-system, sans-serif',e.fillStyle="#1e293b",e.textAlign="left";const c=r.split(`
`),h=32,v=80;let u=100;e.font='bold 28px "Inter", -apple-system, sans-serif',e.fillStyle="#0f172a",e.fillText("‚ú® Organized Notes",v,u),u+=60,e.font='18px "Inter", -apple-system, sans-serif',c.forEach(d=>{const g=d.trim();g?(g.startsWith("‚Ä¢")||g.startsWith("-")?(e.fillStyle="#3b82f6",e.fillText("‚óè",v,u),e.fillStyle="#334155",e.fillText(g.substring(1).trim(),v+25,u)):g.endsWith(":")?(e.font='bold 20px "Inter", -apple-system, sans-serif',e.fillStyle="#0f172a",e.fillText(g,v,u),e.font='18px "Inter", -apple-system, sans-serif'):(e.fillStyle="#334155",e.fillText(g,v,u)),u+=h):u+=h/2})}function de(){m=0,T=0,b(M,1),i(O)&&X()}zt();var ct=gn();we("a8vy9b",r=>{me(()=>{be.title="AI Note App"})});var bt=D(ct);Ae(bt,{$$events:{mode:se,clear:rt}});var U=A(bt,2);Oe(U,r=>b(n,r),()=>i(n));var It=A(U,2);{var ue=r=>{var c=dn();W(()=>ht(c,`
                left: ${i(p).x??""}px;
                top: ${i(p).y??""}px;
                width: ${i(p).w??""}px;
                height: ${i(p).h??""}px;
            `)),P(r,c)};V(It,r=>{i(N)==="select"&&i(p).active&&!i(O)&&r(ue)})}var wt=A(It,2);{var fe=r=>{var c=un(),h=D(c),v=A(h,2),u=A(v,2),d=A(u,2);L(c),W(g=>ht(c,`
                top: ${i(p).y+i(p).h+16}px;
                left: ${g??""}px;
            `),[()=>Math.max(16,Math.min(i(p).x,window.innerWidth-250))]),R("click",h,()=>lt("mindmap")),R("click",v,()=>lt("analyze")),R("click",u,()=>lt("tidy")),R("click",d,()=>b(f,!1)),P(r,c)};V(wt,r=>{i(f)&&!i(y)&&r(fe)})}var Ot=A(wt,2);{var he=r=>{var c=fn();P(r,c)};V(Ot,r=>{i(y)&&r(he)})}var Rt=A(Ot,2);{var ve=r=>{var c=hn(),h=D(c),v=A(D(h),2),u=D(v);L(v),L(h);var d=A(h,2),g=D(d),w=A(g,2);L(d),L(c),W(E=>At(u,`Zoom: ${E??""}%`),[()=>Math.round(i(M)*100)]),R("click",g,de),R("click",w,rt),P(r,c)};V(Rt,r=>{i(O)&&r(ve)})}var ge=A(Rt,2);{var pe=r=>{var c=vn(),h=D(c),v=A(D(h),2);L(h);var u=A(h,2),d=D(u),g=D(d,!0);L(d),L(u),L(c),W(()=>At(g,i(I).content)),R("click",v,()=>b(I,null)),P(r,c)};V(ge,r=>{i(I)&&!i(O)&&r(pe)})}Ie(2),L(ct),W(()=>ht(U,`cursor: ${i(O)?i(N)==="pan"?i(et)?"grabbing":"grab":i(C)?"grabbing":"grab":i(N)==="pen"?"crosshair":i(N)==="eraser"?"cell":"crosshair"};`)),R("pointerdown",U,_t),R("pointermove",U,mt),R("pointerup",U,at),R("pointerleave",U,at),R("touchstart",U,_t),R("touchmove",U,mt),R("touchend",U,at),P(t,ct),Jt()}export{On as component};
